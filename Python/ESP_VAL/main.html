<!DOCTYPE html>
<!-- 
  БРАУЗЕРНЫЙ ESP "ФАНТОМ ХРОМ"
  Работает через Chrome/Edge с аппаратным ускорением
  Использует WebGPU, WebUSB, WebHID, WebXR API
  Античит не может заблокировать браузер
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVIDIA GeForce Experience - Performance Overlay</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff9d;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }
        
        /* Легитимный вид NVIDIA Overlay */
        .nvidia-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 320px;
            background: rgba(20, 20, 30, 0.95);
            border: 1px solid #00a8ff;
            border-radius: 12px;
            padding: 15px;
            z-index: 2147483647; /* Максимальный z-index */
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 168, 255, 0.3);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .nvidia-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 168, 255, 0.3);
        }
        
        .nvidia-logo {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            filter: drop-shadow(0 0 8px #00ff9d);
        }
        
        .nvidia-title {
            font-size: 16px;
            font-weight: 600;
            color: #00ff9d;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .metric-card {
            background: rgba(10, 20, 30, 0.7);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(0, 168, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            border-color: #00ff9d;
            transform: translateY(-2px);
        }
        
        .metric-label {
            font-size: 11px;
            color: #66c2ff;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: #00ff9d;
            font-family: 'Consolas', monospace;
        }
        
        .metric-unit {
            font-size: 11px;
            color: #66c2ff;
            margin-left: 2px;
        }
        
        .game-overlay-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 168, 255, 0.3);
        }
        
        .section-title {
            font-size: 13px;
            color: #66c2ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "▶";
            margin-right: 8px;
            color: #00ff9d;
        }
        
        .radar-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
            background: radial-gradient(circle, rgba(10, 20, 40, 0.8) 0%, rgba(5, 10, 20, 0.9) 100%);
            border-radius: 50%;
            border: 2px solid rgba(0, 168, 255, 0.3);
            overflow: hidden;
        }
        
        .radar-sweep {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(transparent 80%, rgba(0, 255, 157, 0.3) 100%);
            animation: radarSpin 2s linear infinite;
        }
        
        @keyframes radarSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .enemy-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff3333;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px #ff3333;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
        }
        
        .distance-line {
            position: absolute;
            height: 1px;
            background: rgba(0, 255, 157, 0.5);
            transform-origin: 0 0;
        }
        
        /* Скрытый canvas для анализа экрана */
        #screenCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            z-index: -9999;
        }
        
        /* Overlay крестик для прицела */
        #crosshairOverlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            pointer-events: none;
            z-index: 2147483646;
            opacity: 0.8;
        }
        
        .crosshair-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: #00ff9d;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #00ff9d;
        }
        
        .crosshair-line {
            position: absolute;
            background: #00ff9d;
        }
        
        .crosshair-horizontal {
            width: 16px;
            height: 2px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .crosshair-vertical {
            width: 2px;
            height: 16px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Кнопки управления */
        .control-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 2147483645;
        }
        
        .control-btn {
            background: rgba(0, 168, 255, 0.2);
            border: 1px solid rgba(0, 168, 255, 0.4);
            color: #66c2ff;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .control-btn:hover {
            background: rgba(0, 168, 255, 0.4);
            border-color: #00ff9d;
            color: #00ff9d;
            transform: translateY(-2px);
        }
        
        /* Анимация загрузки */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999999;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 168, 255, 0.3);
            border-top: 4px solid #00ff9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .nvidia-overlay {
                width: 280px;
                top: 10px;
                right: 10px;
            }
            
            .radar-container {
                width: 140px;
                height: 140px;
            }
        }
        
        /* Эффект частиц для фона */
        #particlesCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <!-- Легитимный overlay NVIDIA/AMD -->
    <div class="nvidia-overlay" id="nvidiaOverlay">
        <div class="nvidia-header">
            <div class="nvidia-logo">
                <svg viewBox="0 0 24 24" fill="#00ff9d">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#00ff9d"/>
                    <path d="M2 17L12 22L22 17L12 12L2 17Z" fill="#00ff9d"/>
                </svg>
            </div>
            <div class="nvidia-title">NVIDIA Performance Overlay</div>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">GPU Usage</div>
                <div class="metric-value" id="gpuUsage">87<span class="metric-unit">%</span></div>
            </div>
            <div class="metric-card">
                <div class="metric-label">FPS</div>
                <div class="metric-value" id="fpsCounter">144<span class="metric-unit">FPS</span></div>
            </div>
            <div class="metric-card">
                <div class="metric-label">GPU Temp</div>
                <div class="metric-value" id="gpuTemp">64<span class="metric-unit">°C</span></div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Memory</div>
                <div class="metric-value" id="gpuMemory">5.2<span class="metric-unit">GB</span></div>
            </div>
        </div>
        
        <div class="game-overlay-section">
            <div class="section-title">Game Radar</div>
            <div class="radar-container" id="radarContainer">
                <div class="radar-sweep"></div>
                <!-- Враги будут добавлены через JS -->
            </div>
        </div>
    </div>
    
    <!-- Крестик прицела -->
    <div id="crosshairOverlay">
        <div class="crosshair-dot"></div>
        <div class="crosshair-line crosshair-horizontal"></div>
        <div class="crosshair-line crosshair-vertical"></div>
    </div>
    
    <!-- Скрытые элементы для анализа -->
    <canvas id="screenCanvas"></canvas>
    <canvas id="particlesCanvas"></canvas>
    
    <!-- Панель управления -->
    <div class="control-panel">
        <button class="control-btn" onclick="toggleOverlay()">Toggle Overlay</button>
        <button class="control-btn" onclick="toggleRadar()">Toggle Radar</button>
        <button class="control-btn" onclick="calibrate()">Calibrate</button>
    </div>
    
    <!-- Загрузчик -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <script>
        // === BROWSER ESP CORE SYSTEM ===
        // Работает полностью в браузере, использует современные Web APIs
        
        class BrowserESP {
            constructor() {
                console.log('[BrowserESP] Initializing...');
                
                // Состояние системы
                this.isActive = false;
                this.overlayVisible = true;
                this.radarEnabled = true;
                
                // Данные ESP
                this.enemyPositions = [];
                this.gameData = {};
                this.performanceMetrics = {
                    gpuUsage: 87,
                    fps: 144,
                    gpuTemp: 64,
                    gpuMemory: 5.2
                };
                
                // Web API адаптеры
                this.screenCapture = null;
                this.gamepad = null;
                this.audioContext = null;
                this.usbDevice = null;
                this.hidDevice = null;
                
                // Инициализация
                this.init();
            }
            
            async init() {
                try {
                    // Шаг 1: Запрашиваем разрешения
                    await this.requestPermissions();
                    
                    // Шаг 2: Инициализируем Web APIs
                    await this.initWebAPIs();
                    
                    // Шаг 3: Настраиваем анализ
                    this.setupAnalysis();
                    
                    // Шаг 4: Скрываем загрузчик
                    document.getElementById('loader').style.display = 'none';
                    
                    // Шаг 5: Запускаем систему
                    this.start();
                    
                    console.log('[BrowserESP] System ready');
                    
                } catch (error) {
                    console.error('[BrowserESP] Initialization failed:', error);
                    this.showError('Failed to initialize performance overlay');
                }
            }
            
            async requestPermissions() {
                // Запрашиваем все необходимые разрешения под видом легитимных функций
                const permissions = [
                    // Захват экрана (для анализа игры)
                    { name: 'display-capture' },
                    
                    // Доступ к аудио (для анализа звука игры)
                    { name: 'microphone' },
                    
                    // Доступ к gamepad (для анализа ввода)
                    { name: 'gamepad' },
                    
                    // Геолокация (для маскировки)
                    { name: 'geolocation' },
                    
                    // Уведомления (для отвлечения внимания)
                    { name: 'notifications' }
                ];
                
                for (const permission of permissions) {
                    try {
                        const result = await navigator.permissions.query(permission);
                        console.log(`[BrowserESP] ${permission.name}: ${result.state}`);
                    } catch (e) {
                        // Игнорируем ошибки разрешений
                    }
                }
            }
            
            async initWebAPIs() {
                // Инициализация всех Web APIs для анализа
                
                // 1. WebGPU для аппаратного ускорения
                if ('gpu' in navigator) {
                    try {
                        const adapter = await navigator.gpu.requestAdapter();
                        const device = await adapter.requestDevice();
                        console.log('[BrowserESP] WebGPU initialized');
                    } catch (e) {
                        console.warn('[BrowserESP] WebGPU not available');
                    }
                }
                
                // 2. Screen Capture API для захвата экрана
                try {
                    this.screenCapture = await navigator.mediaDevices.getDisplayMedia({
                        video: {
                            displaySurface: 'monitor',
                            logicalSurface: true
                        },
                        audio: false,
                        preferCurrentTab: false
                    });
                    console.log('[BrowserESP] Screen capture active');
                } catch (e) {
                    console.warn('[BrowserESP] Screen capture not available');
                }
                
                // 3. Gamepad API для анализа ввода
                window.addEventListener("gamepadconnected", (e) => {
                    this.gamepad = e.gamepad;
                    console.log(`[BrowserESP] Gamepad connected: ${this.gamepad.id}`);
                });
                
                // 4. WebUSB для доступа к устройствам
                if ('usb' in navigator) {
                    try {
                        // Ищем устройства с RGB подсветкой
                        const devices = await navigator.usb.getDevices();
                        this.usbDevice = devices[0];
                        console.log('[BrowserESP] USB devices available');
                    } catch (e) {
                        // USB доступ не требуется
                    }
                }
                
                // 5. WebHID для доступа к HID устройствам
                if ('hid' in navigator) {
                    try {
                        const devices = await navigator.hid.getDevices();
                        this.hidDevice = devices[0];
                        console.log('[BrowserESP] HID devices available');
                    } catch (e) {
                        // HID доступ не требуется
                    }
                }
                
                // 6. Audio Context для анализа звука
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('[BrowserESP] Audio context ready');
                
                // 7. WebXR для анализа VR/AR
                if ('xr' in navigator) {
                    console.log('[BrowserESP] WebXR available');
                }
            }
            
            setupAnalysis() {
                // Настройка анализаторов
                
                // 1. Анализатор экрана через Canvas
                this.setupScreenAnalysis();
                
                // 2. Анализатор звука
                this.setupAudioAnalysis();
                
                // 3. Анализатор ввода
                this.setupInputAnalysis();
                
                // 4. Анализатор сети (WebRTC/WebSocket)
                this.setupNetworkAnalysis();
                
                // 5. Система маскировки
                this.setupStealth();
            }
            
            setupScreenAnalysis() {
                // Анализ экрана через Canvas и WebGL
                const canvas = document.getElementById('screenCanvas');
                const ctx = canvas.getContext('2d', { willReadFrequently: true });
                
                if (this.screenCapture) {
                    const video = document.createElement('video');
                    video.srcObject = this.screenCapture;
                    video.play();
                    
                    // Устанавливаем размер canvas под размер экрана
                    video.onloadedmetadata = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                    };
                    
                    // Функция анализа кадров
                    const analyzeFrame = () => {
                        if (!this.isActive) return;
                        
                        // Рисуем кадр на canvas
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        // Анализируем изображение
                        this.analyzeScreenFrame(ctx, canvas);
                        
                        // Следующий кадр
                        requestAnimationFrame(analyzeFrame);
                    };
                    
                    video.onplay = () => {
                        analyzeFrame();
                    };
                } else {
                    // Альтернативный метод: анализ цветов на странице
                    this.setupAlternativeScreenAnalysis();
                }
            }
            
            analyzeScreenFrame(ctx, canvas) {
                // Анализ изображения на экране для обнаружения врагов
                
                try {
                    // Получаем данные изображения
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    // Ищем красные пиксели (враги в Valorant)
                    const enemyPixels = [];
                    
                    // Быстрый анализ каждого 4-го пикселя
                    for (let i = 0; i < data.length; i += 16) { // RGBA = 4 байта, поэтому шаг 16
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        // Критерий красного цвета (враги)
                        if (r > 180 && g < 100 && b < 100) {
                            const pixelIndex = i / 4;
                            const x = pixelIndex % canvas.width;
                            const y = Math.floor(pixelIndex / canvas.width);
                            enemyPixels.push({ x, y });
                        }
                    }
                    
                    // Группируем пиксели в кластеры (врагов)
                    this.enemyPositions = this.clusterPixels(enemyPixels);
                    
                    // Обновляем радар
                    this.updateRadar();
                    
                    // Обновляем метрики производительности
                    this.updatePerformanceMetrics();
                    
                } catch (error) {
                    console.warn('[BrowserESP] Screen analysis error:', error);
                }
            }
            
            clusterPixels(pixels) {
                // Простая кластеризация для группировки пикселей врагов
                const clusters = [];
                const threshold = 50; // Максимальное расстояние между пикселями в кластере
                
                for (const pixel of pixels) {
                    let addedToCluster = false;
                    
                    for (const cluster of clusters) {
                        const center = cluster.center;
                        const distance = Math.sqrt(
                            Math.pow(pixel.x - center.x, 2) + 
                            Math.pow(pixel.y - center.y, 2)
                        );
                        
                        if (distance < threshold) {
                            cluster.points.push(pixel);
                            // Пересчитываем центр
                            cluster.center.x = cluster.points.reduce((sum, p) => sum + p.x, 0) / cluster.points.length;
                            cluster.center.y = cluster.points.reduce((sum, p) => sum + p.y, 0) / cluster.points.length;
                            addedToCluster = true;
                            break;
                        }
                    }
                    
                    if (!addedToCluster) {
                        clusters.push({
                            points: [pixel],
                            center: { x: pixel.x, y: pixel.y }
                        });
                    }
                }
                
                // Фильтруем маленькие кластеры (шум)
                return clusters.filter(cluster => cluster.points.length > 10);
            }
            
            updateRadar() {
                // Обновление радара с врагами
                const radar = document.getElementById('radarContainer');
                radar.innerHTML = '<div class="radar-sweep"></div>';
                
                if (!this.radarEnabled) return;
                
                // Добавляем врагов на радар
                this.enemyPositions.forEach((enemy, index) => {
                    // Конвертируем экранные координаты в координаты радара
                    const radarX = 50 + (enemy.center.x / window.innerWidth - 0.5) * 100;
                    const radarY = 50 + (enemy.center.y / window.innerHeight - 0.5) * 100;
                    
                    // Ограничиваем в пределах радара
                    const boundedX = Math.max(10, Math.min(90, radarX));
                    const boundedY = Math.max(10, Math.min(90, radarY));
                    
                    // Создаем элемент врага
                    const enemyDot = document.createElement('div');
                    enemyDot.className = 'enemy-dot';
                    enemyDot.style.left = `${boundedX}%`;
                    enemyDot.style.top = `${boundedY}%`;
                    enemyDot.style.animationDelay = `${index * 0.2}s`;
                    
                    // Добавляем линию расстояния
                    const distanceLine = document.createElement('div');
                    distanceLine.className = 'distance-line';
                    distanceLine.style.left = '50%';
                    distanceLine.style.top = '50%';
                    distanceLine.style.width = `${Math.sqrt(
                        Math.pow(boundedX - 50, 2) + Math.pow(boundedY - 50, 2)
                    )}%`;
                    distanceLine.style.transform = `rotate(${Math.atan2(
                        boundedY - 50, boundedX - 50
                    )}rad)`;
                    
                    radar.appendChild(distanceLine);
                    radar.appendChild(enemyDot);
                });
            }
            
            updatePerformanceMetrics() {
                // Обновление показателей производительности (для маскировки)
                const metrics = this.performanceMetrics;
                
                // Добавляем небольшую случайность для реалистичности
                metrics.gpuUsage = 85 + Math.sin(Date.now() / 5000) * 5;
                metrics.fps = 140 + Math.cos(Date.now() / 3000) * 10;
                metrics.gpuTemp = 62 + Math.sin(Date.now() / 7000) * 3;
                metrics.gpuMemory = 5.1 + Math.cos(Date.now() / 10000) * 0.2;
                
                // Обновляем DOM
                document.getElementById('gpuUsage').innerHTML = 
                    `${metrics.gpuUsage.toFixed(0)}<span class="metric-unit">%</span>`;
                document.getElementById('fpsCounter').innerHTML = 
                    `${metrics.fps.toFixed(0)}<span class="metric-unit">FPS</span>`;
                document.getElementById('gpuTemp').innerHTML = 
                    `${metrics.gpuTemp.toFixed(0)}<span class="metric-unit">°C</span>`;
                document.getElementById('gpuMemory').innerHTML = 
                    `${metrics.gpuMemory.toFixed(1)}<span class="metric-unit">GB</span>`;
            }
            
            setupStealth() {
                // Система маскировки и скрытности
                
                // 1. Маскировка под легитимные запросы
                this.maskAsLegitimate();
                
                // 2. Случайное поведение
                this.randomizeBehavior();
                
                // 3. Мониторинг античита
                this.monitorAnticheat();
                
                // 4. Система самоочистки
                this.setupSelfCleanup();
            }
            
            maskAsLegitimate() {
                // Маскировка под легитимный трафик
                
                // Создаем фейковые запросы к популярным сервисам
                const fakeEndpoints = [
                    'https://www.google-analytics.com/collect',
                    'https://stats.g.doubleclick.net/r/collect',
                    'https://telemetry.microsoft.com/v1/data',
                    'https://ocsp.digicert.com/'
                ];
                
                // Периодически отправляем фейковые запросы
                setInterval(() => {
                    const endpoint = fakeEndpoints[Math.floor(Math.random() * fakeEndpoints.length)];
                    fetch(endpoint, {
                        method: 'GET',
                        mode: 'no-cors',
                        credentials: 'omit'
                    }).catch(() => {});
                }, 30000); // Каждые 30 секунд
                
                // Имитируем работу других расширений
                this.imitateBrowserExtensions();
            }
            
            imitateBrowserExtensions() {
                // Имитация популярных расширений браузера
                
                // Grammarly
                const grammarlyScript = document.createElement('script');
                grammarlyScript.src = 'https://grammarly.com/libs/editor.js';
                document.head.appendChild(grammarlyScript);
                
                // Adobe Acrobat
                const adobeScript = document.createElement('script');
                adobeScript.src = 'https://documentcloud.adobe.com/view-sdk/viewer.js';
                document.head.appendChild(adobeScript);
                
                // LastPass
                const lastpassDiv = document.createElement('div');
                lastpassDiv.id = 'lptopspacer';
                lastpassDiv.style.display = 'none';
                document.body.appendChild(lastpassDiv);
            }
            
            monitorAnticheat() {
                // Мониторинг признаков античита
                
                // Проверяем наличие инструментов отладки
                const checkDebugger = () => {
                    const startTime = performance.now();
                    debugger;
                    const endTime = performance.now();
                    
                    // Если дебаггер активен, время будет значительно больше
                    if (endTime - startTime > 100) {
                        console.warn('[BrowserESP] Debugger detected');
                        this.activateStealthMode();
                    }
                };
                
                // Проверяем регулярно
                setInterval(checkDebugger, 10000);
                
                // Мониторим изменения в DOM (возможные инъекции античита)
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList') {
                            mutation.addedNodes.forEach((node) => {
                                if (node.nodeName === 'SCRIPT' && 
                                    node.src && 
                                    node.src.includes('anticheat')) {
                                    console.warn('[BrowserESP] Anticheat script detected');
                                    this.hideEvidence();
                                }
                            });
                        }
                    });
                });
                
                observer.observe(document.head, { childList: true });
            }
            
            activateStealthMode() {
                // Активация режима максимальной скрытности
                console.log('[BrowserESP] Activating stealth mode');
                
                // 1. Скрываем overlay
                this.overlayVisible = false;
                document.getElementById('nvidiaOverlay').style.display = 'none';
                
                // 2. Останавливаем анализ
                this.isActive = false;
                
                // 3. Очищаем данные
                this.enemyPositions = [];
                
                // 4. Удаляем все следы
                this.cleanupTraces();
                
                // 5. Показываем легитимную страницу
                this.showLegitimatePage();
            }
            
            showLegitimatePage() {
                // Показываем легитимную страницу для маскировки
                document.body.innerHTML = `
                    <div style="padding: 50px; text-align: center; font-family: Arial;">
                        <h1>NVIDIA GeForce Experience</h1>
                        <p>Performance overlay is currently unavailable.</p>
                        <p>Please make sure your GPU drivers are up to date.</p>
                        <button onclick="location.reload()">Retry</button>
                    </div>
                `;
            }
            
            cleanupTraces() {
                // Очистка всех следов в браузере
                
                // Очищаем localStorage и sessionStorage
                localStorage.clear();
                sessionStorage.clear();
                
                // Удаляем cookies
                document.cookie.split(";").forEach((c) => {
                    document.cookie = c.replace(/^ +/, "")
                        .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                });
                
                // Очищаем IndexedDB
                if ('indexedDB' in window) {
                    indexedDB.databases().then((databases) => {
                        databases.forEach((db) => {
                            indexedDB.deleteDatabase(db.name);
                        });
                    });
                }
                
                // Очищаем кэш
                if ('caches' in window) {
                    caches.keys().then((cacheNames) => {
                        cacheNames.forEach((cacheName) => {
                            caches.delete(cacheName);
                        });
                    });
                }
            }
            
            start() {
                // Запуск основной системы
                this.isActive = true;
                
                // Запускаем все системы
                this.startParticles();
                this.startInputMonitoring();
                this.startAudioAnalysis();
                
                console.log('[BrowserESP] System started');
            }
            
            startParticles() {
                // Частицы для фона (для легитимного вида)
                const canvas = document.getElementById('particlesCanvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const particles = [];
                const particleCount = 50;
                
                // Создаем частицы
                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 2 + 1,
                        speedX: Math.random() * 0.5 - 0.25,
                        speedY: Math.random() * 0.5 - 0.25,
                        color: `rgba(0, 168, 255, ${Math.random() * 0.3 + 0.1})`
                    });
                }
                
                // Анимация частиц
                const animateParticles = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    particles.forEach(particle => {
                        particle.x += particle.speedX;
                        particle.y += particle.speedY;
                        
                        // Отскок от границ
                        if (particle.x < 0 || particle.x > canvas.width) particle.speedX *= -1;
                        if (particle.y < 0 || particle.y > canvas.height) particle.speedY *= -1;
                        
                        // Рисуем частицу
                        ctx.beginPath();
                        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                        ctx.fillStyle = particle.color;
                        ctx.fill();
                    });
                    
                    requestAnimationFrame(animateParticles);
                };
                
                animateParticles();
                
                // Обновляем размер при изменении окна
                window.addEventListener('resize', () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                });
            }
            
            showError(message) {
                // Показываем ошибку в легитимном стиле
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: #ff3333;
                    padding: 20px;
                    border-radius: 10px;
                    border: 2px solid #ff3333;
                    z-index: 999999;
                    font-family: Arial;
                    text-align: center;
                `;
                errorDiv.innerHTML = `
                    <h3>NVIDIA Overlay Error</h3>
                    <p>${message}</p>
                    <button onclick="this.parentElement.remove()" 
                            style="margin-top: 10px; padding: 5px 15px;">
                        OK
                    </button>
                `;
                document.body.appendChild(errorDiv);
            }
        }
        
        // === ГЛОБАЛЬНЫЕ ФУНКЦИИ ДЛЯ УПРАВЛЕНИЯ ===
        
        let browserESP = null;
        
        function initializeESP() {
            if (!browserESP) {
                browserESP = new BrowserESP();
            }
            return browserESP;
        }
        
        function toggleOverlay() {
            const overlay = document.getElementById('nvidiaOverlay');
            if (browserESP) {
                browserESP.overlayVisible = !browserESP.overlayVisible;
                overlay.style.display = browserESP.overlayVisible ? 'block' : 'none';
            }
        }
        
        function toggleRadar() {
            if (browserESP) {
                browserESP.radarEnabled = !browserESP.radarEnabled;
                if (!browserESP.radarEnabled) {
                    document.getElementById('radarContainer').innerHTML = 
                        '<div class="radar-sweep"></div>';
                }
            }
        }
        
        function calibrate() {
            alert('Calibration complete. Overlay optimized for current game.');
        }
        
        // === ЗАГРУЗКА СИСТЕМЫ ===
        
        // Ждем полной загрузки страницы
        window.addEventListener('load', () => {
            // Задержка для имитации загрузки NVIDIA Overlay
            setTimeout(() => {
                initializeESP();
            }, 1500);
        });
        
        // Обработка закрытия страницы
        window.addEventListener('beforeunload', () => {
            if (browserESP) {
                browserESP.cleanupTraces();
            }
        });
        
        // Прячем консольные логи в продакшене
        if (window.location.hostname !== 'localhost') {
            console.log = function() {};
            console.warn = function() {};
            console.error = function() {};
        }
    </script>
</body>
</html>